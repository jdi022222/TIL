---
description: 최종적으로 직접 서버를 구축한 이유와 그 과정에 대해 정리한 글이므로, 본 글을 참고하여 인프라를 구축하기에는 부적절합니다.
---

# Infra

멈무 일기의 개발이 어느정도 진행이 되면서 개발용, 운영용 서버를 배포해야했다.

그 과정에서 고려한 주요 선택 기준과 최종적으로 On-Premise를 선택한 과정에 대해 정리해보았다.



## 🚣‍♀️ 배포용 서버 선택 기준

멈무일기를 배포하면서 서버를 고를 때 아래와 같은 기준으로 선택했다.

* **비용** : 당장은 수익화 모델이  없었기 때문에 매달 꾸준히 부과되는 **서버 비용**이 가장 큰 고민이였다.
* **편의성** : 인프라 구조에 수정이 발생해도 유연하게 수정이 가능하며, 삽질 시간을 줄이기 위해 레퍼런스가 충분해야한다.
* **고가용성** : 당연하게도, 365일 24시간 안정적으로 서버가 돌아가야한다.



이 중에 가장 중요한 기준은 **비용**이였다. 프로젝트의 인원이 모두 취준생이거나 대학생이며, 당장은 수익화 모델이 없었기 때문에 **비용**을 가장 큰 기준으로 삼았다.



두 번째로 편의성과 고가용성도 중요한 점 중 하나였다.



우선, **무료**로 제공되는 국내 클라우드 서비스인 **Cloud Type**을 이용해 개발용, 배포용 서버를 구축했다.





## 1️⃣ Cloud Type

### Cloud Type이란?

{% embed url="https://cloudtype.io/" %}

<mark style="color:blue;">**Cloud Type**</mark>은 국내에서 런칭된 **컨테이너 기반 PaaS 클라우드 서비스**이다.



### **특징**

* **컨테이너 기반 서비스**이기 때문에 컨테이너화가 가능한 일반적인 서버 소프트웨어를 구동하는 것에 큰 문제가 없지만, 컨테이너 기반인만큼 컨테이너화에 최적화된 **무상태(Stateless)기반의 소프트웨어 개발 및 운영에 가장 적합**하다
* **제한적인 무료**로 제공되어 간단한 프로젝트 배포를 하기에 적합하다.



{% hint style="danger" %}
**23.12.07**부로 구독 기능이 변경되었다.

기존에 제공하던 무료 리소스는 동일하지만, **매일 랜덤한 시간에 서버가 1회 종료**되도록 변경되었다.

따라서 운영용 서버로 사용하기에는 부적절하다고 판단했다.
{% endhint %}

{% embed url="https://help.cloudtype.io/pricing/2023-12-07" %}



<figure><img src="../../.gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

위처럼 매일 랜덤한 시간에 서버가 중지된다.



### 결론

위처럼 매일 한 번씩 수동으로 서버를 재구동해야하는 문제점이 있기 때문에 다른 클라우드 서비스로 마이그레이션해야했다. 매일 동일한 시간에 서버가 종료된다면 웹 크롤링 스크립트를 짜서 자동으로 재시동하는 방법도 생각해봤을 것인데, 랜덤한 시간이기 때문에 포기했다.





## 2️⃣ AWS

글의 서두에 언급햇듯이, 서버의 선택 기준은 아래와 같다.

* **비용**
* **편의성**
* **고가용성**&#x20;

<mark style="color:blue;">**Cloud Type**</mark>이 유료화가 됨에 따라 다양한 Managed Service를 제공해 **편의성**이 높은 AWS를 이용하기로 했다.&#x20;

하지만 가장 큰 선택 기준은 **비용**이였기 때문에, Serverless를 고려해보았다.



### Serverless

Serverless는 실제 Server가 없는 것은 아니고, 인프라(서버)의 존재를 모르는 상태에서 서비스를 사용할 수 있다는 의미로 사용되는 용어이다.



장점은 다음과 같다.

* 노는 자원이 없이 실제 사용한 만큼만 과금된다.
* 개발자가 서버에 대한 관리를 하지 않아도 된다.

본인의 서버 선택 기준인 **비용**, **편의성**, **고가용성**을 모두 만족하기 때문에 선택하지 않을 이유가 없었다.



실제 서비스를 구성한다면 아래와 같다.

<figure><img src="../../.gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure>

다만, 이미 Spring Boot로 개발이 어느정도 완성된 상태였고 아래에 언급한 **Cold Start**라는 문제가 존재해서 선택하지 않았다.



### Cold Start 문제

Spring Boot를 Lamda에 적용하기 위해서는 **Cold Start**라는 것을 해결해야한다.

Spring Boot로 만든 프로젝트는 부트스트랩 과정이 길기 때문에 최초로 들어온 첫 요청에 대한 응답 시간이 오래 걸린다.



이를 해결하기 위해서는

1. Spring 프레임워크를 제거해 라이브러리만을 통해 개발한다.
2. 초기 로딩 속도를 올리기 위한 튜닝을 한다.



개발 초기 단계였다면 Lamda에 적합한&#x20;



따라서 기존 Spring Boot 프로젝트를 Lamda로 옮기기에는 부적절하다.



추가적으로, 단지 비용을 줄이기 위해(물론 중요한 부분이긴 하다) 기존 서비스에 Lamda관련 코드가 추가되는 것이 개발 효율상 좋지 못하다고 판단했다. 따라서 Serverless를 위해 Lamda를 통한 배포는 선택하지 않았다.



추후 Node.js나 Fast API 혹은 Django를 통해 서버 배포를 할 기회가 생긴다면 Lamda를 통해 배포해고 싶긴하다. DynamoDB도 이용해 완전한 Serverless를 구현해보는 것도 경험해보면 좋을 것 같다.





### EC2 vs ECS

일단 배포를 위해 도커를 통한 컨테이너 단위로 배포하기 위해서는 ECS가 적절했다. 하지만 ECS는 하나의 컨테이너만 배포 가능하므로, Blue-Green 방식의 무중단 배포를 구현하거나 서버 이중화를 할 경우 많은 인스턴스가 사용될 수 있어 비용적인 측면에서 좋지 못하다.



하나의 EC2에&#x20;

<figure><img src="../../.gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>



### 결론

특히나 ELS는 예키치 못하게 종료되도 AWS가 재시동해서 고가용성을 지킬 수 있다.&#x20;

하지만





## 3️⃣ On-Premise



### Ubuntu Server





### 무중단 배포

CloudType은 컨테이너 기반 서비스이기 때문에 jar파일만 배포해도 컨테이너를 통한 무중단배포가 가능하다.

AWS의 EC2는 `nohup`이라는 명령어를 통해 간편하게 무중단 배포 스크립트를 작성할 수 있다.



하지만, 위와 같이 PaaS같은 Managed Service Ubuntu를 이용해 자체적으로&#x20;



### 우아한 종료







## 🚀 최종 구조도

<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>









